<main class="container my-4">


    <div class="hero mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="mb-1">Student Management Portal</h2>
                <p class="mb-0 muted-small">
                    Welcome to student connect. Only one portal you need to manage students
                    of your organization.
                </p>
            </div>
        </div>
    </div>

    <!-- Below Div is to display errors -->
    <div *ngIf="error" class="error-container">
        <img src="https://cdn-icons-png.flaticon.com/512/7486/7486742.png" class="error-img" />
        <h3 class="mt-4">{{ error.title }}</h3>
        <p class="muted-small mb-3">{{ error.message }}</p>
        <button class="btn btn-primary btn-sm" (click)="fetchStudents()">
            Try Again
        </button>
    </div>

    <!-- Display count cards -->
    <div *ngIf="showData">

        <div class="row g-3 mb-3">

            <div class="col-sm-4">
                <div class="p-3 count-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="muted-small">Total Students</div>
                            <h4>{{ counts.total }}</h4>
                        </div>
                        <i class="bi bi-people fs-3"></i>
                    </div>
                </div>
            </div>

            <div class="col-sm-4">
                <div class="p-3 count-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="muted-small">Male</div>
                            <h4>{{ counts.male }}</h4>
                        </div>
                        <i class="bi bi-gender-male fs-3 text-success"></i>
                    </div>
                </div>
            </div>

            <div class="col-sm-4">
                <div class="p-3 count-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="muted-small">Female</div>
                            <h4>{{ counts.female }}</h4>
                        </div>
                        <i class="bi bi-gender-female fs-3 text-danger"></i>
                    </div>
                </div>
            </div>

        </div>

        <!-- Filter for below students cards -->
        <div class="card mb-3 count-card">
            <div class="card-body">
                <div class="row g-2 align-items-center">

                    <div class="col-md-4">
                        <input class="form-control" placeholder="Search by name or email..."
                            [(ngModel)]="state.searchText" (keyup.enter)="applyFilters()" />
                    </div>

                    <div class="col-md-3 d-flex align-items-center">
                        <div class="me-3 muted-small">Gender:</div>

                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" [(ngModel)]="maleChecked"
                                (ngModelChange)="toggleGender('Male', $event)" />
                            <label class="form-check-label">Male</label>
                        </div>

                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" [(ngModel)]="femaleChecked"
                                (ngModelChange)="toggleGender('Female', $event)" />
                            <label class="form-check-label">Female</label>
                        </div>

                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" [(ngModel)]="otherChecked"
                                (ngModelChange)="toggleGender('Other', $event)" />
                            <label class="form-check-label">Other</label>
                        </div>
                    </div>

                    <div class="col-md-3 d-flex align-items-center">
                        <div class="me-2 muted-small">Page size:</div>
                        <select class="form-select form-select-sm pageSizeSelect" style="width:90px"
                            [ngModel]="state.pageSize" (ngModelChange)="onPageSizeChange($event)">
                            <option [value]="5">5</option>
                            <option [value]="10">10</option>
                            <option [value]="20">20</option>
                            <option [value]="50">50</option>
                            <option [value]="100">100</option>
                        </select>
                    </div>

                    <div class="col-md-2 text-end">
                        <button class="btn btn-primary btn-sm" (click)="applyFilters()" [disabled]="loading">
                            {{ loading ? 'Loading...' : 'Apply' }}
                        </button>


                        <button class="btn btn-outline-secondary btn-sm" (click)="resetFilters()">
                            Reset
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Cards to display student -->
        <div class="row g-3 mb-3">
            <div class="col-12 col-sm-6 col-md-4 col-lg-3" *ngFor="let student of students">
                <div class="card card-student h-100" (click)="openDetail(student)">
                    <div class="card-body d-flex flex-column">

                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0">
                                {{ student.firstName }} {{ student.lastName }}
                            </h6>
                            <span class="tag">{{ student.gender }}</span>
                        </div>

                        <div class="muted-small mb-2">
                            {{ student.address }}
                        </div>

                        <div class="mb-3 small">
                            <div><strong>Email:</strong> {{ student.email }}</div>
                            <div>
                                <strong>Age:</strong> {{ student.age }}
                                &nbsp; <strong>Percentage:</strong> {{ student.percentage }}
                            </div>
                        </div>

                        <div class="mt-auto d-flex justify-content-between align-items-center">
                            <small class="muted-small">
                                Created: {{ student.createdAt | date }}
                            </small>

                            <button class="btn btn-sm btn-outline-primary"
                                (click)="$event.stopPropagation(); openDetail(student)">
                                Show Detail
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center mb-5">

            <small class="text-muted">
                Page {{ state.pageNo }} of {{ state.totalPages }}
                â€¢ Total: {{ state.totalElements }}
            </small>

            <div>
                <button class="btn btn-outline-primary btn-sm me-1" (click)="changePage(state.pageNo - 1)"
                    [disabled]="state.firstPage">
                    Prev
                </button>

                <span class="mx-2">{{ state.pageNo }}</span>

                <button class="btn btn-outline-primary btn-sm" (click)="changePage(state.pageNo + 1)"
                    [disabled]="state.lastPage">
                    Next
                </button>
            </div>

        </div>

    </div>
</main>